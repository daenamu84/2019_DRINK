<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Vendor">
    
    
     <select id="getTeamList" resultType="DataMap">
    	<![CDATA[
    		SELECT DEPT_NO, TEAMNM, USE_YN
			FROM T_DEPT_M
			WHERE USE_YN = 'Y'
			ORDER BY SORT_ORD  
       	]]>
    </select>
    
    <select id="getVendorList" resultType="DataMap">
    	<![CDATA[
    		SELECT A.VENDOR_NO, A.OUTLET_NM, (SELECT D.TEAMNM FROM T_DEPT_M D WHERE D.DEPT_NO= C.DEPT_NO) AS TEAMNM,
			  C.EMP_NM, A.VENDOR_TEL_NO, A.VENDOR_ADDR, 
			 (SELECT E.CMM_CD_NM FROM T_CMM_CD_M E WHERE E.CMM_CD_GRP_ID='00005' AND E.CMM_CD = A.MARKET_DIVS_CD) AS MARKGET_NM,
			 (SELECT E.CMM_CD_NM FROM T_CMM_CD_M E WHERE E.CMM_CD_GRP_ID='00006' AND E.CMM_CD = A.VENDOR_SGMT_DIVS_CD) AS SGMT_NM,
			 (SELECT E.CMM_CD_NM FROM T_CMM_CD_M E WHERE E.CMM_CD_GRP_ID='00001' AND E.CMM_CD = A.VENDOR_STAT_CD ) AS STAT_NM
			FROM T_VENDOR_M A, T_VENDOR_EMP_D B, T_EMP_M C
			WHERE A.VENDOR_NO = B.VENDOR_NO
			AND B.EMP_NO = C.EMP_NO
			AND B.EFF_END_DT='99991231'  
       	]]>
    </select>
    
     <select id="getMngTeamList" resultType="DataMap">
    	<![CDATA[
    		SELECT DISTINCT B.DEPT_NO, B.TEAMNM
			FROM T_DEPT_EMP_REL_D A, T_DEPT_M B
			WHERE A.EMP_DEPT_REL_GBN_CD ='0001'
				AND A.EFF_END_DT ='99991231'
				AND A.DEPT_NO = B.DEPT_NO
				AND B.USE_YN = 'Y'
			ORDER BY B.SORT_ORD 
       	]]>
    </select>
    
     <select id="getDeptEmpList" resultType="DataMap">
    	<![CDATA[
    		SELECT DISTINCT B.EMP_NO, B.EMP_NM
			FROM T_DEPT_EMP_REL_D A, T_EMP_M B
			WHERE A.EMP_DEPT_REL_GBN_CD ='0002'
				AND A.EFF_END_DT ='99991231'
				AND A.DEPT_NO = B.DEPT_NO
				AND A.DEPT_NO= #{deptno}
				AND B.USE_YN = 'Y'
			ORDER BY B.EMP_NO
       	]]>
    </select>
    
    <select id="getVendorCnt" resultType="DataMap">
    	<![CDATA[
    		 SELECT 
				COALESCE(count(VENDOR_NO),0) CNT
			 FROM T_VENDOR_M
			 WHERE VENDOR_NO = #{vendor_no}   
       	]]>
    </select>    
    
    <update id="masterInsert">
    	<![CDATA[
    	INSERT INTO T_VENDOR_M
			(OUTLET_NM ,VENDOR_STAT_CD , VENDOR_GRD_CD, VENDOR_AREA_CD, VENDOR_ZIP_NO ,VENDOR_ADDR ,VENDOR_TEL_NO ,VENDOR_URL ,MARKET_DIVS_CD ,VENDOR_SGMT_DIVS_CD ,VENDOR_BRNO, VENDOR_RRNO,
  			 WHOLESALE_YN, WHOLESALE_VENDOR_NO ,GOV_REL_D ,GOV_REL_CNTN ,BANK_NM ,BANK_ACCNT_NO ,BANK_ACCNT_NM ,PAYMENT_TERM ,DATA_REG_DTM ,DATA_REG_ID ,DATA_UPD_DTM, DATA_UPD_ID) 
			VALUES ( #{outlet_nm}, '01', #{vendor_grd_cd}, #{vendor_area_cd}, #{vendor_zip_no}, #{vendor_addr}, #{vendor_tel_no}, #{vendor_url}, #{market_divs_cd}, #{vendor_sgmt_divs_cd}, #{vendor_brno}, (HEX(AES_ENCRYPT(#{vendor_rrno}, 'tb_sms'))),
			#{wholesale_yn}, #{wholesale_vendor_no}, #{gov_rel_d}, #{gov_rel_cntn}, #{bank_nm}, (HEX(AES_ENCRYPT(#{bank_accnt_no}, 'tb_sms'))), #{bank_accnt_nm}, #{payment_term}, now(), #{login_id}, now(), #{login_id})
    	]]>
    </update>
     
    <update id="detailInsert">
    	<![CDATA[
    	INSERT INTO T_VENDOR_EMP_D
			(VENDOR_NO, EFF_END_DT, EFF_STA_DT, MNGR_DIVS_CD, EMP_NO, DATA_REG_DTM, DATA_REG_ID, DATA_UPD_DTM , DATA_UPD_ID) 
			VALUES ( #{vendor_no}, '99991231',  DATE_FORMAT(now(), '%Y%m%d'), '0001', #{empno}, now(),#{login_id}, now(),#{login_id})
    	]]>
    </update>
    
    <update id="vendor_userInsert">
    	<![CDATA[
    	INSERT INTO T_VENDOR_USER_D
			( VENDOR_NO, RELR_DIVS_CD, RELR_NM, RELR_DEPT_NM, RELR_POSTION_NM, RELR_EMAIL, RELR_TEL_NO, RELR_ANVS_DT,
			  ETC, DATA_REG_DTM, DATA_REG_ID, DATA_UPD_DTM, DATA_UPD_ID) 
			VALUES ( #{vendor_no}, #{relr_divs_cd}, #{relr_nm}, #{relr_dept_nm}, #{relr_postion_nm}, #{relr_email}, #{relr_tel_no}, #{relr_anvs_dt}, #{etc}, now(), #{login_id}, now(),#{login_id})
    	]]>
    </update>
    
    <update id="masterUpdate">
    	<![CDATA[
    		UPDATE T_VENDOR_M
    			SET   OUTLET_NM =   #{outlet_nm}
    			  	,VENDOR_ZIP_NO = #{vendor_zip_no}
				  	,VENDOR_ADDR = #{vendor_addr}
				  	,VENDOR_TEL_NO = #{vendor_tel_no}
				  	,VENDOR_URL = #{vendor_url}
				  	,MARKET_DIVS_CD = #{market_divs_cd}
				  	,VENDOR_SGMT_DIVS_CD = #{vendor_sgmt_divs_cd}
				  	,WHOLESALE_YN = #{wholesale_yn}
				  	,WHOLESALE_VENDOR_NO =#{wholesale_vendor_no}
				  	,GOV_REL_D = #{gov_rel_d}
				  	,GOV_REL_CNTN =#{gov_rel_cntn}
				  	,BANK_NM = #{bank_nm}
				  	,BANK_ACCNT_NO = (HEX(AES_ENCRYPT(#{bank_accnt_no}, 'tb_sms')))
				  	,BANK_ACCNT_NM =#{bank_accnt_nm}
				  	,PAYMENT_TERM = #{payment_term}
    				,DATA_UPD_DTM = NOW()
    				,DATA_UPD_ID = #{login_id}
    	    WHERE VENDOR_NO = #{vendor_no}
    	]]>
    </update>
    
    <update id="detailupdate">
    	<![CDATA[
    		UPDATE T_VENDOR_EMP_D
    		SET EFF_END_DT = DATE_FORMAT(now(), '%Y%m%d'),
    		    DATA_UPD_DTM = now(),
    			DATA_UPD_ID =   #{login_id}
 			WHERE VENDOR_NO = #{vendor_no}			
    	]]>
    </update>
    
    <select id="getdetailEmpNo" resultType="DataMap">
    	<![CDATA[
    		 SELECT 
				EMP_NO
			 FROM T_VENDOR_EMP_D
			 WHERE VENDOR_NO = #{vendor_no} 
			 AND EFF_END_DT='99991231'  
       	]]>
    </select>  
    
     <select id="getVendorNo" resultType="DataMap">
    	<![CDATA[
		  	SELECT VENDOR_NO
			FROM T_VENDOR_M 
			WHERE OUTLET_NM =#{outlet_nm} 
       	]]>
    </select>
    
    <select id="getVendorView" resultType="DataMap">
    	<![CDATA[
		 SELECT A.VENDOR_NO, A.OUTLET_NM, A.VENDOR_STAT_CD, A.VENDOR_GRD_CD, A.VENDOR_AREA_CD, 
		          A.VENDOR_ZIP_NO, A.VENDOR_ADDR, A.VENDOR_TEL_NO, A.VENDOR_URL, A.MARKET_DIVS_CD, 
		          A.VENDOR_SGMT_DIVS_CD, A.VENDOR_BRNO, CAST(AES_DECRYPT(UNHEX(A.VENDOR_RRNO), 'tb_sms')  as char(100)) as VENDOR_RRNO , A.WHOLESALE_YN, A.WHOLESALE_VENDOR_NO, 
		          A.GOV_REL_D, A.GOV_REL_CNTN, A.BANK_NM, CAST(AES_DECRYPT(UNHEX(A.BANK_ACCNT_NO), 'tb_sms')  as char(200)) as BANK_ACCNT_NO, A.BANK_ACCNT_NM, 
		          A.PAYMENT_TERM, B.EMP_NO, (SELECT DEPT_NO FROM T_EMP_M D WHERE D.EMP_NO = B.EMP_NO) AS DEPT_NO,
		          C.RELR_DIVS_CD , C.RELR_NM, C.RELR_DEPT_NM, C.RELR_POSTION_NM, C.RELR_EMAIL,
		          RELR_TEL_NO, C.RELR_ANVS_DT, C.ETC
		  FROM T_VENDOR_M A , T_VENDOR_EMP_D B, T_VENDOR_USER_D C
		  WHERE A.VENDOR_NO = B.VENDOR_NO
		  AND A.VENDOR_NO =#{vendor_no} 
		  AND A.VENDOR_NO = C.VENDOR_NO
		  AND B.VENDOR_NO = C.VENDOR_NO 
       	]]>
    </select>
    
    
</mapper>