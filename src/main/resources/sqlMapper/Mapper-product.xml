<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Product">
    
    
    <update id="productInsert">
    	<![CDATA[
		INSERT INTO T_PROD_M
			(BRAND_ID, SUB_BRAND_ID, PROD_ML_CD, USE_YN, DATA_REG_DTM, DATA_REG_ID, DATA_UPD_DTM, DATA_UPD_ID) 
			VALUES (#{brandId}, #{subBrandId}, #{prodMlCd}, #{useYn}, now(), '0', now(), '0')    	
    	]]>
    </update>
    
    
    <select id="getProductList" resultType="DataMap">
    	<![CDATA[
    		SELECT P.PROD_NO, P.BRAND_ID, B.BRAND_NM, SB.SUB_BRAND_ID, SB.SUB_BRAND_NM,
    					(SELECT E.CMM_CD_NM FROM T_CMM_CD_M E WHERE E.CMM_CD_GRP_ID='00017' AND E.CMM_CD = P.PROD_ML_CD) AS PROD_ML_NM, 
    					P.PROD_ML_CD, 
    					(SELECT E.CMM_CD_NM FROM T_CMM_CD_M E WHERE E.CMM_CD_GRP_ID='00015' AND E.CMM_CD = SB.LIQ_KD_CD) AS LIQ_KD_NM,
    					SB.LIQ_KD_CD,
    					(SELECT E.CMM_CD_NM FROM T_CMM_CD_M E WHERE E.CMM_CD_GRP_ID='00014' AND E.CMM_CD = B.ORCO_BRAND_YN) AS ORCO_BRAND_NM,
    					B.ORCO_BRAND_YN, 
    					P.USE_YN
			FROM T_PROD_M P, T_BRAND_M B, T_SUB_BRAND_M SB
			WHERE P.BRAND_ID = B.BRAND_ID
			AND P.SUB_BRAND_ID = SB.SUB_BRAND_ID
			AND B.BRAND_ID = SB.BRAND_ID
			AND B.BRAND_ID IN
       	]]>
			<foreach collection="brandId" item="var" open="(" close=")" separator=",">#{var}</foreach>
    </select>

    <select id="getProductDetail" resultType="DataMap">
    	<![CDATA[
    		SELECT P.PROD_NO, P.BRAND_ID, B.BRAND_NM, SB.SUB_BRAND_ID, SB.SUB_BRAND_NM, P.PROD_ML_CD, SB.LIQ_KD_CD, B.ORCO_BRAND_YN, P.USE_YN
			FROM T_PROD_M P, T_BRAND_M B, T_SUB_BRAND_M SB
			WHERE P.BRAND_ID = B.BRAND_ID
			AND P.SUB_BRAND_ID = SB.SUB_BRAND_ID
			AND B.BRAND_ID = SB.BRAND_ID
			AND P.PROD_NO = #{prodNo}
			LIMIT 1
       	]]>
    </select>
    
    <update id="productUpdate">
    	<![CDATA[
		UPDATE T_PROD_M
			SET PROD_ML_CD = #{prodMlCd},
				  USE_YN = #{useYn},
				  DATA_UPD_DTM = NOW(),
    			  DATA_UPD_ID = '1'
		   WHERE PROD_NO = #{prodNo}
    	]]>
    </update>
    
    
    <select id="getProdSearchList" resultType="DataMap">
    	<![CDATA[
    		SELECT P.PROD_NO, P.BRAND_ID, M.BRAND_NM, P.SUB_BRAND_ID, S.SUB_BRAND_NM, P.PROD_ML_CD, V.SALE_PRICE, V.SALE_STA_DT, V.SALE_END_DT 
    		FROM T_PROD_M P LEFT JOIN T_VENDOR_MENU_D V, 
			ON V.PROD_NO = P.PROD_NO
			AND V.VENDOR_NO = ${vendorId} 
			, T_SUB_BRAND_M S, T_BRAND_M M
			WHERE 1=1
			AND P.BRAND_ID = S.BRAND_ID
			AND P.SUB_BRAND_ID = S.SUB_BRAND_ID
			AND M.BRAND_ID = S.BRAND_ID 
       	]]>
    </select>
    
    <select id="getProdSearchView" resultType="DataMap">
    	<![CDATA[
    		SELECT P.PROD_NO, P.BRAND_ID, M.BRAND_NM, P.SUB_BRAND_ID, S.SUB_BRAND_NM, P.PROD_ML_CD, V.SALE_PRICE, V.SALE_STA_DT, V.SALE_END_DT 
    		FROM T_PROD_M P , T_VENDOR_MENU_D V, T_SUB_BRAND_M S, T_BRAND_M M, T_EMP_M E, T_VENDOR_EMP_D D
			WHERE 1=1
			AND V.PROD_NO = P.PROD_NO
			AND P.BRAND_ID = S.BRAND_ID
			AND P.SUB_BRAND_ID = S.SUB_BRAND_ID
			AND M.BRAND_ID = S.BRAND_ID 
	        AND E.EMP_NO = D.EMP_NO
	        AND D.VENDOR_NO = V.PROD_NO
	        AND D.VENDOR_NO = ${vendorId}
	        AND V.SALE_STA_DT = #{staDt} 
      		AND V.SALE_END_DT = #{endDt}
      		AND E.DEPT_NO = #{deptNo}
            AND E.EMP_NO =  #{empNo}
       	]]>
       	/* 팀 팀원 기간 */
    </select>
</mapper>